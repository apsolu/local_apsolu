define(["jquery","enrol_select/jquery.popupoverlay"],function($){return{initialise:function(){$('#apsolu-attendance-table').before('<div id="apsolu-attendance-check-javascript-helper" class="text-right"><p>Pour les présences <u>non saisies</u> :<ul class="list-inline">'+'<li><span class="btn btn-xs btn-primary" id="apsolu-check-radio-present">Cocher "présent" pour tous</span></li>'+'<li><span class="btn btn-xs btn-primary" id="apsolu-check-radio-absent">Cocher "absent" pour tous</span></li>'+'</ul></div>');$('#apsolu-check-radio-present').click(function(){$('#apsolu-attendance-table tbody tr').each(function(){if($(this).find('input[type=radio]:checked').length==0){$(this).find('input[type=radio]').first().prop('checked',true);}});});$('#apsolu-check-radio-absent').click(function(){$('#apsolu-attendance-table tbody tr').each(function(){if($(this).find('input[type=radio]:checked').length==0){$(this).find('input[type=radio]').last().prop('checked',true);}});});$('.apsolu-attendance-edit-enrolments').click(function(event){event.preventDefault();var popup=$('#apsolu-attendance-popup');if(popup.length==0){$('#page-footer').append('<div id="apsolu-attendance-popup"></div>');popup=$('#apsolu-attendance-popup');}
data=new Object();data.userid=$(this).data('userid');data.courseid=$(this).data('courseid');data.enrolid=$(this).data('enrolid');data.statusid=$(this).data('statusid');data.roleid=$(this).data('roleid');$.ajax({url:M.cfg.wwwroot+"/local/apsolu/attendance/ajax/edit_enrolment.php",type:'POST',data:data,dataType:'json'}).done(function(result){try{$('#apsolu-attendance-popup').html(result.form);apsolu_attendance_handle_edit_enrolments_form();}catch(e){console.log(e);}});popup.css({backgroundColor:'#EEEEEE',padding:'.5em',cursor:'default',maxWidth:'50%',textAlign:'justify'});popup.popup('show');});function apsolu_attendance_handle_edit_enrolments_form(){$('#apsolu-attendance-ajax-edit-enrolment form').submit(function(event){event.preventDefault();var popup=document.querySelector("#apsolu-attendance-popup .alert");if(popup!==null){popup.remove();}
$.ajax({url:M.cfg.wwwroot+"/local/apsolu/attendance/ajax/edit_enrolment.php",type:'POST',data:$('#apsolu-attendance-ajax-edit-enrolment form').serialize(),dataType:'json'}).done(function(result){$('#apsolu-attendance-popup').html(result.form);var status=$('.apsolu-attendance-status[data-userid='+result.userid+']');if(status.length==1){status.html(result.status);$('.apsolu-attendance-edit-enrolments[data-userid='+result.userid+']').data('statusid',result.statusid);}
var role=$('.apsolu-attendance-role[data-userid='+result.userid+']');console.log(result.role);if(role.length==1){console.log(result.role);role.html(result.role);$('.apsolu-attendance-edit-enrolments[data-userid='+result.userid+']').data('roleid',result.roleid);}
apsolu_attendance_handle_edit_enrolments_form();});});$('#apsolu-attendance-ajax-edit-enrolment form .cancel').click(function(event){event.preventDefault();var popup=$('#apsolu-attendance-popup');popup.popup('hide');});}}};});