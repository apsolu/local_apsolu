define("local_apsolu/attendance",["jquery","enrol_select/jquery.popupoverlay"],(function($){return{initialise:function(){let attendancestatus=document.querySelectorAll("#apsolu-attendance-table tbody tr:first-child .apsolu-attendance-status-form input");if(attendancestatus){let dropdown='<div class="dropdown"><button class="btn btn-primary dropdown-toggle" type="button" id="apsolu-dropdown-status-selector" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Pour les présences <u>non saisies</u> :</button><div class="dropdown-menu" aria-labelledby="apsolu-dropdown-status-selector">';for(let i=0;i<attendancestatus.length;i++){let state=attendancestatus[i];dropdown+='<button class="apsolu-status-selector dropdown-item" data-value="'+state.value+'">Cocher "'+state.parentNode.textContent.trim()+'"</button>'}dropdown+='<div class="dropdown-divider"></div><button class="apsolu-status-selector dropdown-item" data-value="0">Tout décocher</button></div></div>';let quickform=document.createElement("div");quickform.id="apsolu-attendance-check-javascript-helper",quickform.classList="text-right",quickform.innerHTML=dropdown;let table=document.getElementById("apsolu-attendance-table");table.parentNode.insertBefore(quickform,table),document.querySelectorAll(".apsolu-status-selector").forEach((function(btn){btn.addEventListener("click",(function(evnt){evnt.preventDefault(),$("#apsolu-attendance-table tbody tr").each((function(){let ischecked=0!=$(this).find("input[type=radio]:checked").length,value=btn.getAttribute("data-value");0==value?ischecked&&$(this).find("input[type=radio]").prop("checked",!1):ischecked||$(this).find("input[type=radio][value="+value+"]").prop("checked",!0)}))}))}))}function apsolu_attendance_handle_edit_enrolments_form(){$("#apsolu-attendance-ajax-edit-enrolment form").submit((function(event){event.preventDefault();var popup=document.querySelector("#apsolu-attendance-popup .alert");null!==popup&&popup.remove(),$.ajax({url:M.cfg.wwwroot+"/local/apsolu/attendance/ajax/edit_enrolment.php",type:"POST",data:$("#apsolu-attendance-ajax-edit-enrolment form").serialize(),dataType:"json"}).done((function(result){$("#apsolu-attendance-popup").html(result.form);var status=$(".apsolu-attendance-status[data-userid="+result.userid+"]");1==status.length&&(status.html(result.status),$(".apsolu-attendance-edit-enrolments[data-userid="+result.userid+"]").data("statusid",result.statusid));var role=$(".apsolu-attendance-role[data-userid="+result.userid+"]");1==role.length&&(role.html(result.role),$(".apsolu-attendance-edit-enrolments[data-userid="+result.userid+"]").data("roleid",result.roleid)),apsolu_attendance_handle_edit_enrolments_form()}))})),$("#apsolu-attendance-ajax-edit-enrolment form .cancel").click((function(event){event.preventDefault(),$("#apsolu-attendance-popup").popup("hide")}))}$("#apsolu-attendance-table tbody tr input[type=radio]").click((function(){var name=$(this).attr("name");$('#apsolu-attendance-table tbody tr input[name="'+name+'"]').not(this).removeProp("hasbeenpreviouslychecked"),this.hasbeenpreviouslychecked?(this.checked=!1,$(this).removeProp("hasbeenpreviouslychecked")):this.hasbeenpreviouslychecked=!0})),$(".apsolu-attendance-edit-enrolments").click((function(event){event.preventDefault();var popup=$("#apsolu-attendance-popup");0==popup.length&&($("#page-footer").append('<div id="apsolu-attendance-popup"></div>'),popup=$("#apsolu-attendance-popup"));var data=new Object;data.userid=$(this).data("userid"),data.courseid=$(this).data("courseid"),data.enrolid=$(this).data("enrolid"),data.statusid=$(this).data("statusid"),data.roleid=$(this).data("roleid"),$.ajax({url:M.cfg.wwwroot+"/local/apsolu/attendance/ajax/edit_enrolment.php",type:"POST",data:data,dataType:"json"}).done((function(result){try{$("#apsolu-attendance-popup").html(result.form),apsolu_attendance_handle_edit_enrolments_form()}catch(e){console.log(e)}})),popup.css({backgroundColor:"#EEEEEE",padding:".5em",cursor:"default",maxWidth:"50%",textAlign:"justify"}),popup.popup("show")}))},setupcourse:function(){var btn1=document.getElementById("block-apsolu-course-edit-enrol-a"),btn2=document.getElementById("block-apsolu-course-edit-attendance-a");if(btn1||btn2){var box=document.getElementById("page-content");if(box){var li,ul=document.createElement("ul");ul.className="list-inline text-center";for(var elements=[btn1,btn2],i=0;i<elements.length;i++)elements[i]&&((li=document.createElement("li")).className="list-inline-item my-2",li.append(elements[i].cloneNode(!0)),ul.append(li));box.prepend(ul)}}}}}));

//# sourceMappingURL=attendance.min.js.map