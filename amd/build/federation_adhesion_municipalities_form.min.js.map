{"version":3,"file":"federation_adhesion_municipalities_form.min.js","sources":["../src/federation_adhesion_municipalities_form.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Search municipality selector module.\n *\n * @module local_apsolu/federation_adhesion_municipalities_form\n * @copyright 2025 Universit√© Rennes 2\n * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery', 'core/ajax'], function($, Ajax) {\n    return {\n        processResults: function(selector, results) {\n            var municipalities = [];\n            $.each(results, function(index, municipality) {\n                municipalities.push({\n                    value: municipality.inseecode,\n                    label: municipality.name + ' (' + municipality.departmentid + ')'\n                });\n            });\n            return municipalities;\n        },\n\n        transport: function(selector, query, success, failure) {\n            var promise;\n\n            // Search within specific course if known and if the 'search within' dropdown is set\n            // to search within course or activity.\n            var args = {query: query};\n\n            // Call AJAX request.\n            promise = Ajax.call([{methodname: 'local_apsolu_get_relevant_municipalities', args: args}]);\n\n            // When AJAX request returns, handle the results.\n            promise[0].then(function(results) {\n                var promises = [];\n\n                // Render label with name and departmentid.\n                $.each(results, function(index, municipality) {\n                    promises.push(municipality.name + ' (' + municipality.departmentid + ')');\n                });\n\n                // Apply the label to the results.\n                return $.when.apply($.when, promises).then(function() { // eslint-disable-line promise/no-nesting\n                    var args = arguments;\n                    var i = 0;\n                    $.each(results, function(index, municipality) {\n                        municipality._label = args[i++];\n                    });\n                    success(results);\n                    return;\n                });\n\n            }).fail(failure);\n        }\n    };\n});\n"],"names":["define","$","Ajax","processResults","selector","results","municipalities","each","index","municipality","push","value","inseecode","label","name","departmentid","transport","query","success","failure","args","call","methodname","then","promises","when","apply","arguments","i","_label","fail"],"mappings":";;;;;;;AAuBAA,8DAAO,CAAC,SAAU,cAAc,SAASC,EAAGC,YACjC,CACHC,eAAgB,SAASC,SAAUC,aAC3BC,eAAiB,UACrBL,EAAEM,KAAKF,SAAS,SAASG,MAAOC,cAC5BH,eAAeI,KAAK,CAChBC,MAAOF,aAAaG,UACpBC,MAAOJ,aAAaK,KAAO,KAAOL,aAAaM,aAAe,SAG/DT,gBAGXU,UAAW,SAASZ,SAAUa,MAAOC,QAASC,aAKtCC,KAAO,CAACH,MAAOA,OAGTf,KAAKmB,KAAK,CAAC,CAACC,WAAY,2CAA4CF,KAAMA,QAG5E,GAAGG,MAAK,SAASlB,aACjBmB,SAAW,UAGfvB,EAAEM,KAAKF,SAAS,SAASG,MAAOC,cAC5Be,SAASd,KAAKD,aAAaK,KAAO,KAAOL,aAAaM,aAAe,QAIlEd,EAAEwB,KAAKC,MAAMzB,EAAEwB,KAAMD,UAAUD,MAAK,eACnCH,KAAOO,UACPC,EAAI,EACR3B,EAAEM,KAAKF,SAAS,SAASG,MAAOC,cAC5BA,aAAaoB,OAAST,KAAKQ,QAE/BV,QAAQb,eAIbyB,KAAKX"}