define("local_apsolu/population_reports",["jquery","core/notification","core/ajax","local_apsolu/moment","local_apsolu/jszip","local_apsolu/datatables.net","local_apsolu/datatables.net-buttons","local_apsolu/datatables.net-bs4","buttons.bootstrap4","buttons.html5"],(function($,notification,Ajax,moment){return{init:function(selector){moment.locale("fr"),$(document).ready((function(){"0"!=$("#id_reportid").val()&&$("#id_reportid").trigger("change")})),$("#id_reportid").change((function(){var requests=[],selector=".report-enrolList-table";if($.fn.dataTable.isDataTable(selector)&&(table=$(selector).DataTable(),table.destroy(),$(selector).empty()),"0"!=this.value){$("#spinner").css("visibility","visible");var requests=Ajax.call([{methodname:"local_apsolu_get_reportdataset",args:{classname:"population",reportid:this.value}}]);requests[0].done((function(enrols){enrols.tooltip&&console.log(enrols.tooltip);var jsonorder=JSON.parse(enrols.orders),order=[];for(var i in jsonorder)order.push([i,jsonorder[i]]);var options={data:JSON.parse(enrols.data),columns:JSON.parse(enrols.columns,(function(key,value){return value&&"string"==typeof value&&0===value.indexOf("function")?(eval("var jsFunc = "+value),jsFunc):value})),columnDefs:[{targets:"_all",render:function(data,type,row,meta){return"filter"===type&&(null===data||""===data)?"(Vide)":data}}],order:order,buttons:["excelHtml5","csvHtml5"],dom:'<"top"Bfi>rt<"bottom"lp><"clear">',pageLength:30,language:{sEmptyTable:"Aucune donnée disponible dans le tableau",sInfo:"Affichage de l'élément _START_ à _END_ sur _TOTAL_ éléments",sInfoEmpty:"Affichage de l'élément 0 à 0 sur 0 élément",sInfoFiltered:"(filtré à partir de _MAX_ éléments au total)",sInfoPostFix:"",sInfoThousands:",",sLengthMenu:"Afficher _MENU_ éléments",sLoadingRecords:"Chargement...",sProcessing:"Traitement...",sSearch:"Rechercher :",sZeroRecords:"Aucun élément correspondant trouvé",oPaginate:{sFirst:"Premier",sLast:"Dernier",sNext:"Suivant",sPrevious:"Précédent"},oAria:{sSortAscending:": activer pour trier la colonne par ordre croissant",sSortDescending:": activer pour trier la colonne par ordre décroissant"},select:{rows:{_:"%d lignes sélectionnées",0:"Aucune ligne sélectionnée",1:"1 ligne sélectionnée"}}},initComplete:function(settings,json){if($("#spinner").css("visibility","hidden"),enrols.filters){var filters=JSON.parse(enrols.filters);$(selector+" thead tr").clone(!1).appendTo(selector+" thead"),$(selector+" thead tr:eq(1) th").removeAttr("class").html(""),filters.input&&this.api().columns(filters.input).every((function(){var column=this;if(column.visible()){var title=$(column.header()).html();$('<input type="text" class="column_search" placeholder=" '+title+'" />').appendTo($(selector+" thead tr:eq(1) th").eq(column.index()).empty()).on("keyup change",(function(){var val=$.fn.dataTable.util.escapeRegex($(this).val());column.search(val).draw()}))}})),filters.select&&this.api().columns(filters.select).every((function(){var column=this;if(column.visible()){var select=$('<select><option value=""></option></select>').appendTo($(selector+" thead tr:eq(1) th").eq(column.index()).empty()).on("change",(function(){var val=$.fn.dataTable.util.escapeRegex($(this).val());column.search(val?"^"+val+"$":"",!0,!1).draw()}));column.data().unique().sort().each((function(d,j){if("Jour"!=$(column.header()).html()){null!==d&&""!==d||(d="(Vide)");var values=select.children("option").map((function(i,e){return e.value||e.innerText})).get();-1===$.inArray(d,values)&&select.append('<option value="'+d+'">'+d+"</option>")}else select.append('<option value="'+moment.weekdays()[d]+'">'+moment.weekdays()[d]+"</option>")}))}}))}}},table=$(selector).DataTable(options);table.unique(),$(selector+" tbody").on("click","a",(function(e){e.preventDefault();var rulesid=$(this).data("rules");if(rulesid){var rules=table.row($(this).parents("tr")).data()[rulesid];window.open("/local/apsolu/statistics/population/index.php?page=custom&rules="+btoa(rules),"_blank")}return!1}))})).fail(notification.exception)}}))}}}));

//# sourceMappingURL=population_reports.min.js.map