{"version":3,"file":"programme_reports.min.js","sources":["../src/programme_reports.js"],"sourcesContent":["define(\n  [\n    \"jquery\",\n    'core/notification',    \n    \"core/ajax\",\n    \"local_apsolu/moment\", \n    \"local_apsolu/jszip\",   \n    \"local_apsolu/datatables.net\",\n    \"local_apsolu/datatables.net-buttons\",\n    \"local_apsolu/datatables.net-bs4\",\n    \"buttons.bootstrap4\",\n    \"buttons.html5\",\n  ],\n  function($, notification, Ajax, moment) {\n    return {\n      init: function(selector) {\n\n        moment.locale('fr');\n        \n        $(document).ready(function(){\n            var reportid = $( \"#id_reportid\" ).val(); \n            if (reportid != \"0\") {\n              $( \"#id_reportid\" ).trigger(\"change\");\n            } \n        });\n        \n        $( \"#id_reportid\" ).change(function() {\n          var requests = [];\n          var selector = '.report-enrolList-table';\n          \n          // Destroy results table        \n          if ( $.fn.dataTable.isDataTable( selector ) ) {\n            table = $(selector).DataTable();\n            table.destroy();\n            $(selector).empty(); \n          } \n          \n          if (this.value != \"0\") {\n            $(\"#spinner\").css('visibility', 'visible');\n            \n            // Get Report value\n            var requests = Ajax.call([{\n              methodname: 'local_apsolu_get_reportdataset',\n              args: {'classname':'programme','reportid':this.value}\n            }]);\n            \n            requests[0].done(function(enrols) {\n              // Display tooltip\n              if (enrols.tooltip) {\n                console.log (enrols.tooltip)\n              }\n            \n              // Get ordering\n              var json_order = JSON.parse(enrols.orders);\n              var order = [];\n              for(var i in json_order)\n                  order.push([i, json_order[i]]);\n                  \n              // Build results table\n              var options = {\n                data : JSON.parse(enrols.data),\n                columns: JSON.parse(enrols.columns, function (key, value) {\n                    if (value && (typeof value === 'string') && value.indexOf(\"function\") === 0) {\n                        eval(\"var jsFunc = \" + value);\n                        return jsFunc;\n                    }\n                    return value;\n                }),\n                order: order,\n                buttons: ['excelHtml5','csvHtml5'],\n                dom: '<\"top\"Bfi>rt<\"bottom\"lp><\"clear\">', //'dom': 'lfrtip',\n                pageLength:30,\n                language: {\n                      \"sEmptyTable\":     \"Aucune donnée disponible dans le tableau\",\n                      \"sInfo\":           \"Affichage de l'élément _START_ à _END_ sur _TOTAL_ éléments\",\n                      \"sInfoEmpty\":      \"Affichage de l'élément 0 à 0 sur 0 élément\",\n                      \"sInfoFiltered\":   \"(filtré à partir de _MAX_ éléments au total)\",\n                      \"sInfoPostFix\":    \"\",\n                      \"sInfoThousands\":  \",\",\n                      \"sLengthMenu\":     \"Afficher _MENU_ éléments\",\n                      \"sLoadingRecords\": \"Chargement...\",\n                      \"sProcessing\":     \"Traitement...\",\n                      \"sSearch\":         \"Rechercher :\",\n                      \"sZeroRecords\":    \"Aucun élément correspondant trouvé\",\n                      \"oPaginate\": {\n                          \"sFirst\":    \"Premier\",\n                          \"sLast\":     \"Dernier\",\n                          \"sNext\":     \"Suivant\",\n                          \"sPrevious\": \"Précédent\"\n                      },\n                      \"oAria\": {\n                          \"sSortAscending\":  \": activer pour trier la colonne par ordre croissant\",\n                          \"sSortDescending\": \": activer pour trier la colonne par ordre décroissant\"\n                      },\n                      \"select\": {\n                              \"rows\": {\n                                  \"_\": \"%d lignes sélectionnées\",\n                                  \"0\": \"Aucune ligne sélectionnée\",\n                                  \"1\": \"1 ligne sélectionnée\"\n                              } \n                      }              \n                    },\n                initComplete: function(settings, json) {\n                  $(\"#spinner\").css('visibility', 'hidden');                          \n                          \n                  // Build columns filters\n                  if (enrols.filters) {\n                    var filters = JSON.parse(enrols.filters);\n                    \n                    $(selector+' thead tr').clone(false).appendTo( selector+' thead' );\n                    $(selector+' thead tr:eq(1) th').removeAttr('class').html('');\n                    \n                    if (filters.input) {\n                      this.api().columns(filters.input).every( function () {\n                        var column = this;\n                        if (column.visible()) {\n                          \n                          var title = $(column.header()).html();\n                          var input = $('<input type=\"text\" class=\"column_search\" placeholder=\" '+title+'\" />')\n                              .appendTo( $(selector+' thead tr:eq(1) th').eq(column.index()).empty() )\n                              .on( 'keyup change', function () {\n                                  var val = $.fn.dataTable.util.escapeRegex(\n                                      $(this).val()\n                                  );\n                                  column\n                                          .search(val)\n                                          .draw();\n                              } );\n                        }\n                      });\n                    }\n                    if (filters.select) {\n                      this.api().columns(filters.select).every( function () {\n                        var column = this;\n                        if (column.visible()) {\n                          var select = $('<select><option value=\"\"></option></select>')\n                              .appendTo( $(selector+' thead tr:eq(1) th').eq(column.index()).empty() )\n                              .on( 'change', function () {\n                                  var val = $.fn.dataTable.util.escapeRegex(\n                                      $(this).val()\n                                  );\n           \n                                  column\n                                      .search( val ? '^'+val+'$' : '', true, false )\n                                      .draw();\n                              } );\n           \n                          column.data().unique().sort().each( function ( d, j ) {\n                            var title = $(column.header()).html();\n                            if (title != \"Jour\")\n                            {                      \n                              select.append( '<option value=\"'+d+'\">'+d+'</option>' )\n                            } else {\n                              select.append( '<option value=\"'+moment.weekdays()[d]+'\">'+moment.weekdays()[d]+'</option>' )\n                            }\n                          }); \n                        }\n                      });\n                    }\n                  }\n                  \n                },\n                \n                \n              };\n                      \n              var table = $(selector).DataTable(options);\n              table.unique(); // Remove doublons\n              \n              \n            }).fail(notification.exception);     \n            \n            \n          }            \n        });\n\n      }\n    };\n  }\n);\n\n"],"names":["define","$","notification","Ajax","moment","init","selector","locale","document","ready","val","trigger","change","requests","fn","dataTable","isDataTable","table","DataTable","destroy","empty","this","value","css","call","methodname","args","done","enrols","tooltip","console","log","json_order","JSON","parse","orders","order","i","push","options","data","columns","key","indexOf","eval","jsFunc","buttons","dom","pageLength","language","initComplete","settings","json","filters","clone","appendTo","removeAttr","html","input","api","every","column","visible","title","header","eq","index","on","util","escapeRegex","search","draw","select","unique","sort","each","d","j","append","weekdays","fail","exception"],"mappings":"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"}