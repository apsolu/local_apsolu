{"version":3,"file":"programme_reports.min.js","sources":["../src/programme_reports.js"],"sourcesContent":["/* eslint-disable */\ndefine(\n  [\n    \"jquery\",\n    'core/notification',\n    \"core/ajax\",\n    \"local_apsolu/moment\",\n    \"local_apsolu/jszip\",\n    \"local_apsolu/datatables.net\",\n    \"local_apsolu/datatables.net-buttons\",\n    \"local_apsolu/datatables.net-bs4\",\n    \"buttons.bootstrap4\",\n    \"buttons.html5\",\n  ],\n  function($, notification, Ajax, moment) {\n    return {\n      init: function(selector) {\n\n        moment.locale('fr');\n\n        $(document).ready(function() {\n            var reportid = $(\"#id_reportid\").val();\n            if (reportid != \"0\") {\n              $(\"#id_reportid\").trigger(\"change\");\n            }\n        });\n\n        $(\"#id_reportid\").change(function() {\n          var requests = [];\n          var selector = '.report-enrolList-table';\n\n          // Destroy results table\n          if ($.fn.dataTable.isDataTable(selector)) {\n            table = $(selector).DataTable();\n            table.destroy();\n            $(selector).empty();\n          }\n\n          if (this.value != \"0\") {\n            $(\"#spinner\").css('visibility', 'visible');\n\n            // Get Report value\n            var requests = Ajax.call([{\n              methodname: 'local_apsolu_get_reportdataset',\n              args: {'classname': 'programme', 'reportid': this.value}\n            }]);\n\n            // Change le titre du document, afin que DataTable l'utilise comme nom de fichier à l'exportation.\n            // Exemple: \"Rapports | Population | Statistiques | APSOLU\" devient \"Rapports | Libellé menu déroulant | APSOLU\".\n            document.title = document.title.replace(/([^\\|]+)\\| .* \\|(.*)$/, \"\\$1- \" + $(this).find(':selected').text() + \" -\\$2\");\n\n            requests[0].done(function(enrols) {\n              // Display tooltip\n              if (enrols.tooltip) {\n                console.log(enrols.tooltip); // eslint-disable-line no-console\n              }\n\n              // Get ordering\n              var jsonorder = JSON.parse(enrols.orders);\n              var order = [];\n              for (var i in jsonorder) {\n                  order.push([i, jsonorder[i]]);\n              }\n\n              // Build results table\n              var options = {\n                data: JSON.parse(enrols.data),\n                columns: JSON.parse(enrols.columns, function(key, value) {\n                    if (value && (typeof value === 'string') && value.indexOf(\"function\") === 0) {\n                        eval(\"var jsFunc = \" + value);\n                        return jsFunc;\n                    }\n                    return value;\n                }),\n                order: order,\n                buttons: ['excelHtml5', 'csvHtml5'],\n                dom: '<\"top\"Bfi>rt<\"bottom\"lp><\"clear\">', // 'dom': 'lfrtip',\n                pageLength: 30,\n                language: {\n                      \"sEmptyTable\":     \"Aucune donnée disponible dans le tableau\",\n                      \"sInfo\":           \"Affichage de l'élément _START_ à _END_ sur _TOTAL_ éléments\",\n                      \"sInfoEmpty\":      \"Affichage de l'élément 0 à 0 sur 0 élément\",\n                      \"sInfoFiltered\":   \"(filtré à partir de _MAX_ éléments au total)\",\n                      \"sInfoPostFix\":    \"\",\n                      \"sInfoThousands\":  \",\",\n                      \"sLengthMenu\":     \"Afficher _MENU_ éléments\",\n                      \"sLoadingRecords\": \"Chargement...\",\n                      \"sProcessing\":     \"Traitement...\",\n                      \"sSearch\":         \"Rechercher :\",\n                      \"sZeroRecords\":    \"Aucun élément correspondant trouvé\",\n                      \"oPaginate\": {\n                          \"sFirst\":    \"Premier\",\n                          \"sLast\":     \"Dernier\",\n                          \"sNext\":     \"Suivant\",\n                          \"sPrevious\": \"Précédent\"\n                      },\n                      \"oAria\": {\n                          \"sSortAscending\":  \": activer pour trier la colonne par ordre croissant\",\n                          \"sSortDescending\": \": activer pour trier la colonne par ordre décroissant\"\n                      },\n                      \"select\": {\n                              \"rows\": {\n                                  \"_\": \"%d lignes sélectionnées\",\n                                  \"0\": \"Aucune ligne sélectionnée\",\n                                  \"1\": \"1 ligne sélectionnée\"\n                              }\n                      }\n                    },\n                initComplete: function(settings, json) {\n                  $(\"#spinner\").css('visibility', 'hidden');\n\n                  // Build columns filters\n                  if (enrols.filters) {\n                    var filters = JSON.parse(enrols.filters);\n\n                    $(selector + ' thead tr').clone(false).appendTo(selector + ' thead');\n                    $(selector + ' thead tr:eq(1) th').removeAttr('class').html('');\n\n                    if (filters.input) {\n                      this.api().columns(filters.input).every( function () {\n                        var column = this;\n                        if (column.visible()) {\n\n                          var title = $(column.header()).html();\n                          var input = $('<input type=\"text\" class=\"column_search\" placeholder=\" ' + title + '\" />')\n                              .appendTo($(selector + ' thead tr:eq(1) th').eq(column.index()).empty())\n                              .on('keyup change', function() {\n                                  var val = $.fn.dataTable.util.escapeRegex(\n                                      $(this).val()\n                                  );\n                                  column\n                                          .search(val)\n                                          .draw();\n                              });\n                        }\n                      });\n                    }\n                    if (filters.select) {\n                      this.api().columns(filters.select).every(function() {\n                        var column = this;\n                        if (column.visible()) {\n                          var select = $('<select><option value=\"\"></option></select>')\n                              .appendTo($(selector + ' thead tr:eq(1) th').eq(column.index()).empty())\n                              .on('change', function() {\n                                  var val = $.fn.dataTable.util.escapeRegex(\n                                      $(this).val()\n                                  );\n\n                                  column\n                                      .search(val ? '^' + val + '$' : '', true, false)\n                                      .draw();\n                              });\n\n                          column.data().unique().sort().each(function(d, j) {\n                            var title = $(column.header()).html();\n                            if (title != \"Jour\") {\n                              select.append('<option value=\"' + d + '\">' + d + '</option>');\n                            } else {\n                              select.append('<option value=\"' + moment.weekdays()[d] + '\">' + moment.weekdays()[d] + '</option>');\n                            }\n                          });\n                        }\n                      });\n                    }\n                  }\n\n                },\n\n\n              };\n\n              var table = $(selector).DataTable(options);\n              table.unique(); // Remove doublons\n\n\n            }).fail(notification.exception);\n\n\n          }\n        });\n\n      }\n    };\n  }\n);\n\n"],"names":["define","$","notification","Ajax","moment","init","selector","locale","document","ready","val","trigger","change","requests","fn","dataTable","isDataTable","table","DataTable","destroy","empty","this","value","css","call","methodname","args","title","replace","find","text","done","enrols","tooltip","console","log","jsonorder","JSON","parse","orders","order","i","push","options","data","columns","key","indexOf","eval","jsFunc","buttons","dom","pageLength","language","initComplete","settings","json","filters","clone","appendTo","removeAttr","html","input","api","every","column","visible","header","eq","index","on","util","escapeRegex","search","draw","select","unique","sort","each","d","j","append","weekdays","fail","exception"],"mappings":"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"}