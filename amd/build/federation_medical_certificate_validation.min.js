define("local_apsolu/federation_medical_certificate_validation",["jquery","core_form/modalform","core/str","core/toast"],(function($,ModalForm,Str,notifyUser){return{initialise:function(){$(".local-apsolu-federation-medical-certificate-validation").click((function(event){event.preventDefault();var link=event.target;"A"!==link.tagName&&(link=event.target.parentElement);var strings=[{key:link.getAttribute("data-stringid")+"_subject",component:"local_apsolu"},{key:link.getAttribute("data-stringid")+"_body",component:"local_apsolu"}];Str.get_strings(strings).then((function(results){var subject=results[0],body=results[1],contextid=link.getAttribute("data-contextid"),targetvalidation=link.getAttribute("data-target-validation"),targetvalidationcolor=link.getAttribute("data-target-validation-color"),targetvalidationtext=link.getAttribute("data-target-validation-text"),users=link.getAttribute("data-users"),title=link.textContent;const modalForm=new ModalForm({formClass:"local_apsolu\\form\\send_email_form",args:{users:users,contextid:contextid,targetvalidation:targetvalidation,subject:subject,body:body},modalConfig:{title:title,large:!0,buttons:{save:Str.get_string("send","message")}}});modalForm.addEventListener(modalForm.events.FORM_SUBMITTED,(e=>{let message,countnotifications=0,errors=[],i=0;for(i=0;i<e.detail.length;i++)message=e.detail[i],message.msgid?countnotifications++:errors.push(message.errormessage);if(countnotifications>0&&(1==countnotifications?Str.get_string("message_sent","local_apsolu").then((message=>(console.log(message),notifyUser.add(message)))).fail(Notification.exception):Str.get_string("messages_sent_to_X_users","local_apsolu",countnotifications).then((message=>(console.log(message),notifyUser.add(message)))).fail(Notification.exception)),errors.length>0)for(i=0;i<errors.length;i++)console.log(message),notifyUser.add(errors[i]);else{let element,menuitem,items=users.split(",");for(let i=0;i<items.length;i++)if(element=document.querySelector('td.medical-certificate-status[data-userid="'+items[i]+'"]'),element&&(element.textContent=targetvalidationtext,element.classList.remove("table-success","table-warning","table-danger","table-info"),element.classList.add(targetvalidationcolor),menuitem=document.querySelector('a.dropdown-item[data-users="'+items[i]+'"]'),menuitem)){let menuitemcontainer=menuitem.closest(".action-menu");menuitemcontainer&&menuitemcontainer.remove()}}})),modalForm.show()}))}))}}}));

//# sourceMappingURL=federation_medical_certificate_validation.min.js.map