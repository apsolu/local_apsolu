define(['jquery','core/templates','enrol_select/select2'],function($,templates){return{initialise:function(){function filter(){$('#apsolu-enrol-select tbody tr').css('display','table-row');$('.apsolu-enrol-selects').each(function(){var values=$(this).select2('data');var target=$(this).attr('name');if(values.length===0){return;}
var header;var headerChildren;$('#apsolu-enrol-select tbody tr').each(function(){if($(this).children().length===1){if(headerChildren===0){header.css('display','none');}
header=$(this);headerChildren=0;return;}
if($(this).css('display')==='none'){return;}
for(var i=0;i<values.length;i++){var value=$.trim($(this).children('[data-column="'+target+'"]').attr('data-value'));if(value.indexOf(values[i].text)!==-1){headerChildren++;return;}}
$(this).css('display','none');});if(headerChildren===0){header.css('display','none');}});}
$('.apsolu-enrol-selects').select2({allowClear:true,width:'18em'});$('.apsolu-enrol-selects').on('change.select2',function(){filter();});filter();function toggleFilterBlock(){var filters=document.getElementById('apsolu-offerings-filters-aside');if(filters){if(filters.style.display=='block'){filters.style.display='none';}else{filters.style.display='block';}}}
if(document.getElementsByClassName('select2-selection__choice').length>0){toggleFilterBlock();}
var toggleFiltersButton=document.getElementById('toggle-filters-button');if(toggleFiltersButton){toggleFiltersButton.addEventListener('click',toggleFilterBlock);}
var complementaryrows=document.querySelectorAll('tr[data-category-event]');if(complementaryrows.length>0){var tdindex;for(var i=0;i<complementaryrows.length;i++){if(!tdindex){for(var j=0;j<complementaryrows[i].children.length;j++){if(complementaryrows[i].children[j].classList.contains('hide')===false){tdindex=j;break;}}}
var context={event:complementaryrows[i].getAttribute('data-category-event')};var nodepath='#'+complementaryrows[i].getAttribute('id')+' td:eq('+tdindex+')';var updateTemplate=function(templates,context,nodepath){templates.render('local_apsolu/presentation_event_popover',context).then(function(html,js){templates.prependNodeContents(nodepath,html,js);});};updateTemplate(templates,context,nodepath);}}}};});