/**
 * Module javascript pour l'offre de formations.
 *
 * @module     local_apsolu/presentation
 * @copyright  2020 Universit√© Rennes 2 <dsi-contact@univ-rennes2.fr>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("local_apsolu/presentation",["jquery","core/modal_events","core/modal_factory","core/templates","enrol_select/select2"],(function($,ModalEvents,ModalFactory,templates){return{initialise:function(){function filter(){var filters={};$("#apsolu-presentation-table tbody tr").css("display","table-row"),$(".apsolu-presentation-selects").each((function(){var values=$(this).select2("data"),target=$(this).attr("name");if(0!==values.length){filters[target]=[];for(var i=0;i<values.length;i++)filters[target].push(values[i].id);var header,headerChildren;$("#apsolu-presentation-table tbody tr").each((function(){if(1===$(this).children().length)return 0===headerChildren&&header.css("display","none"),header=$(this),void(headerChildren=0);if("none"!==$(this).css("display")){for(var i=0;i<values.length;i++){var value=$.trim($(this).children('[data-column="'+target+'"]').attr("data-value"));if(!0===("period"===target||"role"===target||"teachers"===target?-1!==value.indexOf(values[i].text):values[i].text===value))return void headerChildren++}$(this).css("display","none")}})),0===headerChildren&&header.css("display","none")}}));var permalink=document.getElementById("apsolu-offerings-permalink-button");if(permalink)if(0===Object.keys(filters).length)permalink.setAttribute("disabled","disabled");else{var anchor=window.btoa(unescape(encodeURIComponent(JSON.stringify(filters))));permalink.removeAttribute("disabled"),permalink.setAttribute("data-href","#"+anchor)}}$(".apsolu-presentation-selects").select2({allowClear:!0,width:"18em"}),$(".apsolu-presentation-selects").on("change.select2",(function(){filter()}));var anchor=window.location.hash;if("#"===anchor.charAt(0)&&(anchor=anchor.slice(1)),""!=anchor){var selections=decodeURIComponent(escape(window.atob(anchor)));try{selections=JSON.parse(selections);for(const selection in selections){var select=$(".apsolu-presentation-selects[name="+selection+"]");select&&(select.val(selections[selection]),select.trigger("change"))}}catch(error){}}function toggleFilterBlock(){var filters=document.getElementById("apsolu-offerings-filters-aside");filters&&("block"==filters.style.display?filters.style.display="none":filters.style.display="block")}filter(),document.getElementsByClassName("select2-selection__choice").length>0&&toggleFilterBlock();var toggleFiltersButton=document.getElementById("toggle-filters-button");toggleFiltersButton&&toggleFiltersButton.addEventListener("click",toggleFilterBlock);var complementaryrows=document.querySelectorAll("tr[data-category-event]");if(complementaryrows.length>0)for(var tdindex,i=0;i<complementaryrows.length;i++){if(!tdindex)for(var j=0;j<complementaryrows[i].children.length;j++)if(!1===complementaryrows[i].children[j].classList.contains("hide")){tdindex=j;break}var context={event:complementaryrows[i].getAttribute("data-category-event")},nodepath="#"+complementaryrows[i].getAttribute("id")+" td:eq("+tdindex+")";!function(templates,context,nodepath){templates.render("local_apsolu/presentation_event_popover",context).then((function(html,js){return templates.prependNodeContents(nodepath,html,js)}))}(templates,context,nodepath)}var permalink=$("#apsolu-offerings-permalink-button");permalink&&ModalFactory.create({large:!0},permalink).done((function(modal){modal.getRoot().on(ModalEvents.shown,(function(){var value=window.location.href.split("#")[0]+document.getElementById("apsolu-offerings-permalink-button").getAttribute("data-href");modal.setBody('<p><input id="apsolu-offerings-permalink-input" size="75" type="text" value="'+value+'" /></p>')}))}))}}}));

//# sourceMappingURL=presentation.min.js.map