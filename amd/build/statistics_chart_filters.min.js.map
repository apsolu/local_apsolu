{"version":3,"file":"statistics_chart_filters.min.js","sources":["../src/statistics_chart_filters.js"],"sourcesContent":["/* eslint-disable */\ndefine(\n  [\n    'jquery',\n    'core/str',\n    'core/chartjs',\n    'core/ajax',\n    'core/chart_builder',\n    'core/chart_output_chartjs',\n    'core/chart_output_htmltable',\n    'core/mustache',\n    'core/templates',\n  ], function($, str, Chartjs, Ajax, Builder, Output, OutputTable, Mustache, Templates) {\n\n    $.extend({\n      resetChart: function(id, args) {\n        Chartjs.helpers.each(Chartjs.instances, function(instance) {\n          if (instance.canvas.parentNode) {\n          if (instance.canvas.parentNode.getAttribute(\"aria-describedby\") == \"chart-table-data-\" + id) {\n            Ajax.call([{\n              methodname: 'local_apsolu_get_chartdataset',\n              args: args,\n              done: function(data) {\n                var chartArea = $('#chart-area-' + id),\n                chartTable = chartArea.find('.chart-table-data'),\n                chartCanvas = chartArea.find('canvas');\n\n                if (data.success) {\n                  chartArea.show();\n                  instance.destroy();\n                  var data = JSON.parse(data.chartdata);\n                  Builder.make(data).then(function(ChartInst) {\n                    new Output(chartCanvas, ChartInst);\n                    new OutputTable(chartTable, ChartInst);\n                  });\n                } else {\n                  chartArea.hide();\n                  alert (JSON.parse(data.chartdata));\n                }\n\n              },\n              fail: Notification.exception\n            }]);\n          }\n          }\n        });\n      },\n\n      actionCriterias: function(uniqid, reportid, criteriatype) {\n        $(\"button[id^='btn-\" + criteriatype + \"-\" + uniqid + \"']\").each(function(i) {\n          $(this).unbind(\"click\");\n          $(this).click(function() {\n            // Set active button\n            $(\"button[id^='btn-\" + criteriatype + \"-\" + uniqid + \"']\").each(function(i) {\n              $(this).removeClass('active');\n            });\n            if ($(this).attr('value') != \"resetCriterias\") {\n              $(this).addClass('active');\n            }\n\n            // Build search criterias\n            var criterias = {};\n            var classname = $(this).attr('data-type');\n            $(\"button.active[id*='-\" + uniqid + \"-']\").each(function(i) {\n              var criteria = $(this).attr('data-criteria');\n              var id = $(this).attr('value');\n              criterias[criteria] = [{\"id\": id, \"active\": true}];\n            });\n            args = {'options': {\"classname\": classname, \"reportid\": reportid, \"criterias\": criterias}};\n\n            // Reset chart from criterias\n            $.resetChart(uniqid, args);\n\n          });\n        });\n      },\n\n      renderCriteria: function(key, uniqid, options) {\n        var label;\n        var strings = [\n            {key: 'statistics_chart_criteria_' + key, component: 'local_apsolu'},\n        ];\n        str.get_strings(strings).then(function (results) {\n            Templates.render('local_apsolu/statistics_chart_filters_criteria', {'btnid':uniqid,'label':results[0]+' : ','criteriatype':key,'options':options.criterias[key],'classname':options.classname})\n              .then(function(html, js) {\n                  Templates.appendNodeContents('#chart-filters-'+uniqid, html, js);\n                  $.actionCriterias(uniqid,options.reportid,key);\n              });\n        });\n\n      },\n\n    });\n\n    $.fn.extend({\n      renderCriterias: function(uniqid, options) {\n        if (options.criterias) {\n          if (options.criterias.cities) {\n            $.renderCriteria(\"cities\", uniqid, options);\n          }\n          if (options.criterias.calendarstypes) {\n            $.renderCriteria(\"calendarstypes\", uniqid, options);\n          }\n          if (options.criterias.complementaries) {\n            $.renderCriteria(\"complementaries\", uniqid, options);\n          }\n        }\n      },\n    });\n  }\n);\n"],"names":["define","$","str","Chartjs","Ajax","Builder","Output","OutputTable","Mustache","Templates","extend","resetChart","id","args","helpers","each","instances","instance","canvas","parentNode","getAttribute","call","methodname","done","data","chartArea","chartTable","find","chartCanvas","success","show","destroy","JSON","parse","chartdata","make","then","ChartInst","hide","alert","fail","Notification","exception","actionCriterias","uniqid","reportid","criteriatype","i","this","unbind","click","removeClass","attr","addClass","criterias","classname","criteria","renderCriteria","key","options","strings","component","get_strings","results","render","html","js","appendNodeContents","fn","renderCriterias","cities","calendarstypes","complementaries"],"mappings":"AACAA,+CACE,CACE,SACA,WACA,eACA,YACA,qBACA,4BACA,8BACA,gBACA,mBACC,SAASC,EAAGC,IAAKC,QAASC,KAAMC,QAASC,OAAQC,YAAaC,SAAUC,WAEzER,EAAES,OAAO,CACPC,WAAY,SAASC,GAAIC,MACvBV,QAAQW,QAAQC,KAAKZ,QAAQa,WAAW,SAASC,UAC3CA,SAASC,OAAOC,YAChBF,SAASC,OAAOC,WAAWC,aAAa,qBAAuB,oBAAsBR,IACvFR,KAAKiB,KAAK,CAAC,CACTC,WAAY,gCACZT,KAAMA,KACNU,KAAM,SAASC,UACTC,UAAYxB,EAAE,eAAiBW,IACnCc,WAAaD,UAAUE,KAAK,qBAC5BC,YAAcH,UAAUE,KAAK,aAEzBH,KAAKK,QAAS,CAChBJ,UAAUK,OACVb,SAASc,UACLP,KAAOQ,KAAKC,MAAMT,KAAKU,WAC3B7B,QAAQ8B,KAAKX,MAAMY,MAAK,SAASC,eAC3B/B,OAAOsB,YAAaS,eACpB9B,YAAYmB,WAAYW,mBAG9BZ,UAAUa,OACVC,MAAOP,KAAKC,MAAMT,KAAKU,aAI3BM,KAAMC,aAAaC,iBAO3BC,gBAAiB,SAASC,OAAQC,SAAUC,cAC1C7C,EAAE,mBAAqB6C,aAAe,IAAMF,OAAS,MAAM7B,MAAK,SAASgC,GACvE9C,EAAE+C,MAAMC,OAAO,SACfhD,EAAE+C,MAAME,OAAM,WAEZjD,EAAE,mBAAqB6C,aAAe,IAAMF,OAAS,MAAM7B,MAAK,SAASgC,GACvE9C,EAAE+C,MAAMG,YAAY,aAEO,kBAAzBlD,EAAE+C,MAAMI,KAAK,UACfnD,EAAE+C,MAAMK,SAAS,cAIfC,UAAY,GACZC,UAAYtD,EAAE+C,MAAMI,KAAK,aAC7BnD,EAAE,uBAAyB2C,OAAS,OAAO7B,MAAK,SAASgC,OACnDS,SAAWvD,EAAE+C,MAAMI,KAAK,iBACxBxC,GAAKX,EAAE+C,MAAMI,KAAK,SACtBE,UAAUE,UAAY,CAAC,IAAO5C,WAAc,OAE9CC,KAAO,SAAY,WAAc0C,mBAAuBV,mBAAuBS,YAG/ErD,EAAEU,WAAWiC,OAAQ/B,aAM3B4C,eAAgB,SAASC,IAAKd,OAAQe,aAEhCC,QAAU,CACV,CAACF,IAAK,6BAA+BA,IAAKG,UAAW,iBAEzD3D,IAAI4D,YAAYF,SAASxB,MAAK,SAAU2B,SACpCtD,UAAUuD,OAAO,iDAAkD,OAASpB,aAAemB,QAAQ,GAAG,mBAAqBL,YAAcC,QAAQL,UAAUI,eAAiBC,QAAQJ,YACjLnB,MAAK,SAAS6B,KAAMC,IACjBzD,UAAU0D,mBAAmB,kBAAkBvB,OAAQqB,KAAMC,IAC7DjE,EAAE0C,gBAAgBC,OAAOe,QAAQd,SAASa,cAQxDzD,EAAEmE,GAAG1D,OAAO,CACV2D,gBAAiB,SAASzB,OAAQe,SAC5BA,QAAQL,YACNK,QAAQL,UAAUgB,QACpBrE,EAAEwD,eAAe,SAAUb,OAAQe,SAEjCA,QAAQL,UAAUiB,gBACpBtE,EAAEwD,eAAe,iBAAkBb,OAAQe,SAEzCA,QAAQL,UAAUkB,iBACpBvE,EAAEwD,eAAe,kBAAmBb,OAAQe"}