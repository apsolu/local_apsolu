{"version":3,"file":"population_reports.min.js","sources":["../src/population_reports.js"],"sourcesContent":["/* eslint-disable */\ndefine(\n  [\n    \"jquery\",\n    'core/notification',\n    \"core/ajax\",\n    \"local_apsolu/moment\",\n    \"local_apsolu/jszip\",\n    \"local_apsolu/datatables.net\",\n    \"local_apsolu/datatables.net-buttons\",\n    \"local_apsolu/datatables.net-bs4\",\n    \"buttons.bootstrap4\",\n    \"buttons.html5\",\n  ],\n  function($, notification, Ajax, moment) {\n    return {\n      init: function(selector) {\n\n        moment.locale('fr');\n\n        $(document).ready(function() {\n            var reportid = $(\"#id_reportid\").val();\n            if (reportid != \"0\") {\n              $(\"#id_reportid\").trigger(\"change\");\n            }\n        });\n\n        $(\"#id_reportid\").change(function() {\n          var requests = [];\n          var selector = '.report-enrolList-table';\n\n          // Destroy results table\n          if ($.fn.dataTable.isDataTable(selector)) {\n            table = $(selector).DataTable();\n            table.destroy();\n            $(selector).empty();\n          }\n\n          if (this.value != \"0\") {\n            $(\"#spinner\").css('visibility', 'visible');\n\n            // Get Report value\n            var requests = Ajax.call([{\n              methodname: 'local_apsolu_get_reportdataset',\n              args: {'classname': 'population', 'reportid': this.value}\n            }]);\n\n            // Change le titre du document, afin que DataTable l'utilise comme nom de fichier à l'exportation.\n            // Exemple: \"Rapports | Population | Statistiques | APSOLU\" devient \"Rapports | Libellé menu déroulant | APSOLU\".\n            document.title = document.title.replace(/([^\\|]+)\\| .* \\|(.*)$/, \"\\$1- \" + $(this).find(':selected').text() + \" -\\$2\");\n\n            requests[0].done(function(enrols) {\n              // Display tooltip\n              if (enrols.tooltip) {\n                console.log(enrols.tooltip); // eslint-disable-line no-console\n              }\n\n              // Get ordering\n              var jsonorder = JSON.parse(enrols.orders);\n              var order = [];\n              for (var i in jsonorder) {\n                  order.push([i, jsonorder[i]]);\n              }\n\n              // Build results table\n              var options = {\n                data: JSON.parse(enrols.data),\n                columns: JSON.parse(enrols.columns, function(key, value) {\n                    if (value && (typeof value === 'string') && value.indexOf(\"function\") === 0) {\n                        eval(\"var jsFunc = \" + value);\n                        return jsFunc;\n                    }\n                    return value;\n                }),\n                columnDefs: [{\n                    \"targets\": '_all',\n                    \"render\": function(data, type, row, meta) {\n                        return type === 'filter' ? (data === null || data === '') ? '(Vide)' : data : data;\n                    }\n                }],\n                order: order,\n                buttons: ['excelHtml5', 'csvHtml5'],\n                dom: '<\"top\"Bfi>rt<\"bottom\"lp><\"clear\">', // 'dom': 'lfrtip',\n                pageLength: 30,\n                language: {\n                      \"sEmptyTable\":     \"Aucune donnée disponible dans le tableau\",\n                      \"sInfo\":           \"Affichage de l'élément _START_ à _END_ sur _TOTAL_ éléments\",\n                      \"sInfoEmpty\":      \"Affichage de l'élément 0 à 0 sur 0 élément\",\n                      \"sInfoFiltered\":   \"(filtré à partir de _MAX_ éléments au total)\",\n                      \"sInfoPostFix\":    \"\",\n                      \"sInfoThousands\":  \",\",\n                      \"sLengthMenu\":     \"Afficher _MENU_ éléments\",\n                      \"sLoadingRecords\": \"Chargement...\",\n                      \"sProcessing\":     \"Traitement...\",\n                      \"sSearch\":         \"Rechercher :\",\n                      \"sZeroRecords\":    \"Aucun élément correspondant trouvé\",\n                      \"oPaginate\": {\n                          \"sFirst\":    \"Premier\",\n                          \"sLast\":     \"Dernier\",\n                          \"sNext\":     \"Suivant\",\n                          \"sPrevious\": \"Précédent\"\n                      },\n                      \"oAria\": {\n                          \"sSortAscending\":  \": activer pour trier la colonne par ordre croissant\",\n                          \"sSortDescending\": \": activer pour trier la colonne par ordre décroissant\"\n                      },\n                      \"select\": {\n                              \"rows\": {\n                                  \"_\": \"%d lignes sélectionnées\",\n                                  \"0\": \"Aucune ligne sélectionnée\",\n                                  \"1\": \"1 ligne sélectionnée\"\n                              }\n                      }\n                    },\n                initComplete: function(settings, json) {\n                  $(\"#spinner\").css('visibility', 'hidden');\n\n                  // Build columns filters\n                  if (enrols.filters) {\n                    var filters = JSON.parse(enrols.filters);\n\n                    $(selector + ' thead tr').clone(false).appendTo(selector + ' thead');\n                    $(selector + ' thead tr:eq(1) th').removeAttr('class').html('');\n\n                    if (filters.input) {\n                      this.api().columns(filters.input).every(function() {\n                        var column = this;\n                        if (column.visible()) {\n\n                          var title = $(column.header()).html();\n                          var input = $('<input type=\"text\" class=\"column_search\" placeholder=\" ' + title + '\" />')\n                              .appendTo($(selector + ' thead tr:eq(1) th').eq(column.index()).empty())\n                              .on('keyup change', function() {\n                                  var val = $.fn.dataTable.util.escapeRegex(\n                                      $(this).val()\n                                  );\n                                  column\n                                          .search(val)\n                                          .draw();\n                              });\n                        }\n                      });\n                    }\n                    if (filters.select) {\n                      this.api().columns(filters.select).every(function() {\n                        var column = this;\n                        if (column.visible()) {\n                          var select = $('<select><option value=\"\"></option></select>')\n                              .appendTo($(selector + ' thead tr:eq(1) th').eq(column.index()).empty())\n                              .on('change', function() {\n                                  var val = $.fn.dataTable.util.escapeRegex(\n                                      $(this).val()\n                                  );\n\n                                  column\n                                      .search(val ? '^' + val + '$' : '', true, false)\n                                      .draw();\n                              });\n\n                          column.data().unique().sort().each(function(d, j) {\n                            var title = $(column.header()).html();\n                            if (title != \"Jour\") {\n                              if (d === null || d === '') {\n                                d = '(Vide)';\n                              }\n                              var values = select.children('option').map(function(i, e) {\n                                  return e.value || e.innerText;\n                              }).get();\n                              if ($.inArray(d, values) === -1) {\n                                  select.append('<option value=\"' + d + '\">' + d + '</option>');\n                              }\n                            } else {\n                              select.append('<option value=\"' + moment.weekdays()[d] + '\">' + moment.weekdays()[d] + '</option>');\n                            }\n                          });\n                        }\n                      });\n                    }\n                  }\n\n                },\n\n\n              };\n\n              var table = $(selector).DataTable(options);\n              table.unique(); // Remove doublons\n\n              // build link to rules\n              $(selector + ' tbody').on('click', 'a', function(e) {\n                e.preventDefault();\n                var rulesid = $(this).data(\"rules\");\n                if (rulesid) {\n                  var data = table.row($(this).parents('tr')).data();\n                  var rules = data[rulesid];\n                  window.open(\"/local/apsolu/statistics/population/index.php?page=custom&rules=\" + btoa(rules), \"_blank\");\n                }\n                return false;\n              });\n            }).fail(notification.exception);\n\n\n          }\n        });\n\n      }\n    };\n  }\n);\n\n"],"names":["define","$","notification","Ajax","moment","init","selector","locale","document","ready","val","trigger","change","requests","fn","dataTable","isDataTable","table","DataTable","destroy","empty","this","value","css","call","methodname","args","title","replace","find","text","done","enrols","tooltip","console","log","jsonorder","JSON","parse","orders","order","i","push","options","data","columns","key","indexOf","eval","jsFunc","columnDefs","type","row","meta","buttons","dom","pageLength","language","initComplete","settings","json","filters","clone","appendTo","removeAttr","html","input","api","every","column","visible","header","eq","index","on","util","escapeRegex","search","draw","select","unique","sort","each","d","j","values","children","map","e","innerText","get","inArray","append","weekdays","preventDefault","rulesid","rules","parents","window","open","btoa","fail","exception"],"mappings":"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"}